import java.sql.*;
import java.util.*;

public class WebAppCombined {
    static final String URL = "jdbc:mysql://localhost:3306/bytexl_db";
    static final String USER = "root";
    static final String PASS = "root";
    static Scanner sc = new Scanner(System.in);

    public static void main(String[] args) {
        try {
            Class.forName("com.mysql.cj.jdbc.Driver");
            while (true) {
                System.out.println("\n===== Web Application Simulation Menu =====");
                System.out.println("1. User Login");
                System.out.println("2. Display Employee Records");
                System.out.println("3. Student Attendance Portal");
                System.out.println("4. Exit");
                System.out.print("Enter your choice: ");
                int choice = sc.nextInt();
                sc.nextLine(); // consume newline

                switch (choice) {
                    case 1:
                        userLogin();
                        break;
                    case 2:
                        showEmployees();
                        break;
                    case 3:
                        attendancePortal();
                        break;
                    case 4:
                        System.out.println("Exiting Program...");
                        return;
                    default:
                        System.out.println("Invalid choice. Try again!");
                }
            }
        } catch (Exception e) {
            System.out.println("Error initializing: " + e.getMessage());
        }
    }

    // ===================== PART (A): USER LOGIN =====================
    public static void userLogin() {
        System.out.println("\n--- User Login ---");
        System.out.print("Enter username: ");
        String uname = sc.nextLine();
        System.out.print("Enter password: ");
        String pwd = sc.nextLine();

        try (Connection con = DriverManager.getConnection(URL, USER, PASS)) {
            String query = "SELECT * FROM users WHERE username=? AND password=?";
            PreparedStatement ps = con.prepareStatement(query);
            ps.setString(1, uname);
            ps.setString(2, pwd);
            ResultSet rs = ps.executeQuery();

            if (rs.next()) {
                System.out.println("✅ Login Successful! Welcome, " + uname + "!");
                System.out.println("You can now access Employee and Attendance modules.");
            } else {
                System.out.println("❌ Invalid username or password!");
            }
        } catch (Exception e) {
            System.out.println("Login Error: " + e.getMessage());
        }
    }

    // ===================== PART (B): EMPLOYEE RECORDS =====================
    public static void showEmployees() {
        System.out.println("\n--- Employee Records ---");
        try (Connection con = DriverManager.getConnection(URL, USER, PASS)) {
            Statement st = con.createStatement();
            ResultSet rs = st.executeQuery("SELECT * FROM employees");

            System.out.printf("%-5s %-15s %-10s\n", "ID", "Name", "Salary");
            System.out.println("-----------------------------------");
            while (rs.next()) {
                System.out.printf("%-5d %-15s %-10.2f\n",
                        rs.getInt("id"), rs.getString("name"), rs.getDouble("salary"));
            }
        } catch (Exception e) {
            System.out.println("Error displaying employees: " + e.getMessage());
        }
    }

    // ===================== PART (C): STUDENT ATTENDANCE PORTAL =====================
    public static void attendancePortal() {
        while (true) {
            System.out.println("\n--- Student Attendance Portal ---");
            System.out.println("1. Mark Attendance");
            System.out.println("2. View Attendance Records");
            System.out.println("3. Back to Main Menu");
            System.out.print("Enter choice: ");
            int ch = sc.nextInt();
            sc.nextLine();

            switch (ch) {
                case 1:
                    markAttendance();
                    break;
                case 2:
                    viewAttendance();
                    break;
                case 3:
                    return;
                default:
                    System.out.println("Invalid choice!");
            }
        }
    }

    public static void markAttendance() {
        System.out.print("Enter Student Name: ");
        String name = sc.nextLine();
        System.out.print("Enter Date (YYYY-MM-DD): ");
        String date = sc.nextLine();
        System.out.print("Enter Status (Present/Absent): ");
        String status = sc.nextLine();

        try (Connection con = DriverManager.getConnection(URL, USER, PASS)) {
            PreparedStatement ps = con.prepareStatement(
                    "INSERT INTO attendance(student_name, date, status) VALUES (?, ?, ?)");
            ps.setString(1, name);
            ps.setString(2, date);
            ps.setString(3, status);
            ps.executeUpdate();
            System.out.println("✅ Attendance recorded successfully!");
        } catch (Exception e) {
            System.out.println("Error marking attendance: " + e.getMessage());
        }
    }

    public static void viewAttendance() {
        System.out.println("\n--- Attendance Records ---");
        try (Connection con = DriverManager.getConnection(URL, USER, PASS)) {
            Statement st = con.createStatement();
            ResultSet rs = st.executeQuery("SELECT * FROM attendance");

            System.out.printf("%-20s %-15s %-10s\n", "Student Name", "Date", "Status");
            System.out.println("------------------------------------------------------");
            while (rs.next()) {
                System.out.printf("%-20s %-15s %-10s\n",
                        rs.getString("student_name"),
                        rs.getString("date"),
                        rs.getString("status"));
            }
        } catch (Exception e) {
            System.out.println("Error viewing attendance: " + e.getMessage());
        }
    }
}
